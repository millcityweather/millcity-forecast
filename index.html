<script>
  const iconMap = {
    "patchy fog": "fog.png",
    "chance rain showers": "rain_light.png",
    "rain showers": "rain_light.png",
    "showers and thunderstorms": "thunderstorm.png",
    "chance showers and thunderstorms": "thunderstorm.png",
    "sunny": "sunny.png",
    "mostly sunny": "mostly_sunny.png",
    "partly sunny": "partly_sunny.png",
    "cloudy": "cloudy.png",
    "mostly cloudy": "mostly_cloudy.png",
    "clear": "clear.png",
    "chance rain": "rain_light.png"
  };

  function matchIcon(desc) {
    desc = desc.toLowerCase();
    for (const key in iconMap) {
      if (desc.includes(key)) return `icons/${iconMap[key]}`;
    }
    return "icons/clear.png"; // fallback icon
  }

  async function loadForecast() {
    const point = await fetch('https://api.weather.gov/points/42.659,-71.355').then(r => r.json());
    const days = await fetch(point.properties.forecast).then(r => r.json());
    const periods = days.properties.periods.slice(0, 7);
    const container = document.getElementById('forecast');
    container.innerHTML = '';
    periods.forEach(p => {
      const icon = matchIcon(p.shortForecast);
      container.innerHTML += `
        <div class="day">
          <h3>${p.name}</h3>
          <img src="${icon}" alt="${p.shortForecast}">
          <div class="desc">${p.shortForecast}</div>
          <div class="temp">${p.temperature}Â°${p.temperatureUnit}</div>
        </div>`;
    });
    document.getElementById('dateBar').textContent = new Date().toLocaleDateString('en-US');
  }

  loadForecast();
  setInterval(loadForecast, 1800000);
</script>
